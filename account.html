<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VocabLoop Account</title>
  <style>
    :root{
      --bg1:#dbeafe; --bg2:#dcfce7; --card:#ffffff; --ink:#0f172a; --muted:#64748b;
      --pri:#2563eb; --pri2:#1d4ed8; --line:#dbe2ea; --ok:#16a34a; --err:#dc2626;
    }
    *{box-sizing:border-box}
    body{margin:0; font-family: Inter, Arial, sans-serif; color:var(--ink);
      background: radial-gradient(1000px 500px at -10% -20%, #c4b5fd 0%, transparent 60%),
                  linear-gradient(145deg,var(--bg1),var(--bg2));
      min-height:100vh;
    }
    .wrap{max-width:560px; margin:32px auto; padding:14px}
    .top{display:flex; align-items:center; justify-content:space-between; margin-bottom:10px}
    .back{border:1px solid var(--line); background:#fff; border-radius:10px; padding:8px 12px; text-decoration:none; color:var(--ink); font-weight:700}
    .card{background:rgba(255,255,255,.9); backdrop-filter: blur(8px); border:1px solid rgba(255,255,255,.7); border-radius:16px; padding:16px; box-shadow:0 10px 30px rgba(0,0,0,.1)}
    h1{margin:6px 0 4px; font-size:1.45rem}
    .muted{color:var(--muted); font-size:.92rem}
    .tabs{display:grid; grid-template-columns:1fr 1fr; gap:8px; margin:14px 0 12px}
    .tab{border:1px solid var(--line); background:#fff; color:#334155; border-radius:10px; padding:10px; font-weight:800; cursor:pointer}
    .tab.active{background:linear-gradient(180deg,var(--pri),var(--pri2)); color:#fff; border-color:transparent}
    .panel{display:none}
    .panel.active{display:block}
    label{display:block; margin:10px 0 6px; font-size:.9rem; font-weight:700}
    input{width:100%; padding:12px; border-radius:10px; border:1px solid var(--line); font-size:1rem; outline:none}
    input:focus{border-color:#93c5fd; box-shadow:0 0 0 3px rgba(147,197,253,.35)}
    .hint{font-size:.82rem; color:var(--muted); margin-top:6px}
    .cta{margin-top:12px; width:100%; border:0; border-radius:10px; padding:12px; color:#fff; background:linear-gradient(180deg,var(--pri),var(--pri2)); font-weight:800; cursor:pointer}
    .msg{margin-top:12px; padding:10px 12px; border-radius:10px; font-size:.9rem; display:none}
    .msg.ok{display:block; background:#ecfdf3; color:var(--ok); border:1px solid #bbf7d0}
    .msg.err{display:block; background:#fef2f2; color:var(--err); border:1px solid #fecaca}
    .token{margin-top:10px; padding:10px; border-radius:10px; background:#0f172a; color:#e2e8f0; font-family:ui-monospace, SFMono-Regular, Menlo, monospace; font-size:.8rem; word-break:break-all}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <a class="back" href="/">← Back to Home</a>
    </div>

    <div class="card">
      <h1>Account</h1>
      <div class="muted">Create your account or login to continue learning across sessions.</div>

      <div class="tabs">
        <button id="tabRegister" class="tab active" onclick="switchTab('register')">Register</button>
        <button id="tabLogin" class="tab" onclick="switchTab('login')">Login</button>
      </div>

      <div id="panelRegister" class="panel active">
        <label for="rUser">Username</label>
        <input id="rUser" placeholder="At least 5 characters" autocomplete="username" />

        <label for="rPass">Password</label>
        <input id="rPass" type="password" placeholder="At least 6 digits" autocomplete="new-password" />
        <div class="hint">Rule: username ≥ 5 chars, password ≥ 6 digits.</div>

        <button class="cta" onclick="register()">Create Account</button>
      </div>

      <div id="panelLogin" class="panel">
        <label for="lUser">Username</label>
        <input id="lUser" placeholder="Your username" autocomplete="username" />

        <label for="lPass">Password</label>
        <input id="lPass" type="password" placeholder="Your password" autocomplete="current-password" />

        <button class="cta" onclick="login()">Login</button>
      </div>

      <div id="msg" class="msg"></div>
      <div id="token" class="token" style="display:none"></div>
    </div>
  </div>

  <script>
    const msg = document.getElementById('msg');
    const tokenBox = document.getElementById('token');

    function switchTab(tab){
      const isRegister = tab === 'register';
      document.getElementById('tabRegister').classList.toggle('active', isRegister);
      document.getElementById('tabLogin').classList.toggle('active', !isRegister);
      document.getElementById('panelRegister').classList.toggle('active', isRegister);
      document.getElementById('panelLogin').classList.toggle('active', !isRegister);
      setMsg('');
    }

    function setMsg(text, type=''){
      msg.className = 'msg';
      msg.textContent = text || '';
      if(!text) return;
      msg.classList.add(type === 'ok' ? 'ok' : 'err');
    }

    function setToken(token){
      if(!token){ tokenBox.style.display='none'; tokenBox.textContent=''; return; }
      tokenBox.style.display='block';
      tokenBox.textContent = `Session token:\n${token}`;
    }

    function saveAuth(user, token){
      if(!user || !user.username || !token) return;
      localStorage.setItem('vocabloop_auth', JSON.stringify({
        username: user.username,
        token,
        at: Date.now()
      }));
    }

    function redirectHome(){
      setTimeout(()=>{ window.location.href = '/'; }, 500);
    }

    async function callAuth(payload){
      const r = await fetch('/api/auth', {
        method:'POST',
        headers:{'content-type':'application/json'},
        body: JSON.stringify(payload)
      });
      return r.json();
    }

    async function register(){
      const username = document.getElementById('rUser').value.trim();
      const password = document.getElementById('rPass').value.trim();
      const data = await callAuth({ action:'register', username, password });
      if(data.ok){
        saveAuth(data.user, data.token);
        setMsg('Registered & logged in successfully. Redirecting to home...','ok');
        setToken(data.token || '');
        redirectHome();
      }else{
        setMsg(data.message || 'Register failed.');
        setToken('');
      }
    }

    async function login(){
      const username = document.getElementById('lUser').value.trim();
      const password = document.getElementById('lPass').value.trim();
      const data = await callAuth({ action:'login', username, password });
      if(data.ok){
        saveAuth(data.user, data.token);
        setMsg(`Welcome back, ${data.user?.username || 'user'}! Redirecting...`,'ok');
        setToken(data.token || '');
        redirectHome();
      }else{
        setMsg(data.message || 'Login failed.');
        setToken('');
      }
    }

    // default tab: register
    switchTab('register');
  </script>
</body>
</html>
